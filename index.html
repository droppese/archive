<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì´í…œ ë¬´ë£Œ ë‚˜ëˆ” ê²Œì‹œíŒ (ìµœì¢… ê´€ë¦¬)</title>
    
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 10px; /* ì „ì²´ íŒ¨ë”© ì¶•ì†Œ */
        }

        .container {
            max-width: 1000px; 
            margin: auto;
            background: #fff;
            padding: 15px; /* ë‚´ë¶€ íŒ¨ë”© ì¶•ì†Œ */
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            min-height: 80vh; 
        }

        h1 {
            color: #333;
            border-bottom: 2px solid #007BFF;
            padding-bottom: 10px;
            font-size: 1.5em; /* ëª¨ë°”ì¼ ëŒ€ë¹„ ì œëª© í¬ê¸° ì¡°ì • */
        }
        
        /* ì‚¬ìš©ì ì»¨íŠ¸ë¡¤ ì˜ì—­ (ìƒë‹¨) */
        #userControlArea {
            position: static; /* ëª¨ë°”ì¼ì—ì„œ ê³ ì • ìœ„ì¹˜ í•´ì œ */
            top: auto;
            right: auto;
            text-align: left;
            margin-bottom: 15px;
            font-size: 0.9em;
            line-height: 1.5;
            display: flex; 
            justify-content: space-between; /* ë²„íŠ¼ê³¼ ìƒíƒœ ë©”ì‹œì§€ ë¶„ë¦¬ */
            flex-wrap: wrap; /* ì¢ì€ í™”ë©´ì—ì„œ ì¤„ë°”ê¿ˆ */
        }
        
        #userControlArea > div {
            margin-top: 5px;
        }

        #userControlArea button, footer button { 
            background-color: #ffc107; 
            color: #333;
            border: none;
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 5px; 
            font-size: 0.8em; /* ë²„íŠ¼ í¬ê¸° ì¶•ì†Œ */
            transition: background-color 0.2s;
            white-space: nowrap;
        }

        /* ë“±ë¡ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #registerButtonContainer {
            margin: 10px 0;
            text-align: right;
        }
        
        /* í…Œì´ë¸” ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.85em; /* í°íŠ¸ í¬ê¸° ì¶•ì†Œ */
        }

        th, td {
            padding: 8px; /* í…Œì´ë¸” íŒ¨ë”© ì¶•ì†Œ */
            text-align: left;
            border-bottom: 1px solid #ddd;
            vertical-align: middle;
        }

        th {
            background-color: #007BFF;
            color: white;
        }
        
        /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .item-thumbnail {
            width: 40px; /* ì¸ë„¤ì¼ í¬ê¸° ì¶•ì†Œ */
            height: 40px; 
            object-fit: cover; 
            border-radius: 4px;
            vertical-align: middle;
        }

        /* ìƒì„¸ ì •ë³´ ì„¹ì…˜ */
        .detail-content {
            padding: 10px;
            font-size: 0.85em; /* ìƒì„¸ ì •ë³´ í°íŠ¸ ì¶•ì†Œ */
            display: block; /* ëª¨ë°”ì¼ì—ì„œ flex í•´ì œ */
        }
        
        /* ì•„ì´í…œ ìƒì„¸ ì •ë³´ í–‰: ì´ˆê¸°ì—ëŠ” ë‹«í˜ ìƒíƒœ ìœ ì§€ */
    tr.detail-row {
        display: none; /* <-- ì´ CSS ì†ì„±ì´ ìƒì„¸ ì •ë³´ë¥¼ ì´ˆê¸° ìƒíƒœì—ì„œ ìˆ¨ê¹ë‹ˆë‹¤. */
        background-color: #e9ecef;
    }
        
        .detail-image {
            max-width: 100%; /* ì´ë¯¸ì§€ í¬ê¸° 100%ë¡œ ì„¤ì • */
            height: auto;
            display: block;
            margin: 0 auto 10px auto; /* ì¤‘ì•™ ì •ë ¬ */
        }

        .detail-text {
            width: 100%; 
            min-width: 0;
        }

        /* ì•„ì´í…œ ë“±ë¡ í¼ ìŠ¤íƒ€ì¼ */
        .form-content {
            display: block; /* ëª¨ë°”ì¼ì—ì„œ Grid í•´ì œ */
        }
        
        .form-content > * {
            margin-bottom: 10px;
        }

        #itemName, #itemImageFile, #itemDescription {
            width: 100%;
            display: block;
        }
        
        #itemDescription {
            height: 100px; /* í…ìŠ¤íŠ¸ ì—ì–´ë¦¬ì–´ ë†’ì´ ì¶•ì†Œ */
        }
        
        .form-actions {
            text-align: center; /* ë²„íŠ¼ ì¤‘ì•™ ì •ë ¬ */
            margin-top: 10px;
        }

        /* í‘¸í„° ìŠ¤íƒ€ì¼ */
        footer {
            text-align: center; /* í‘¸í„° ë²„íŠ¼ ì¤‘ì•™ ì •ë ¬ */
            padding: 10px;
        }
        
        footer button {
            margin: 5px;
            font-size: 0.9em;
        }

        /* ---------- ëª¨ë°”ì¼ ì „ìš© ë¯¸ë””ì–´ ì¿¼ë¦¬ (í™”ë©´ ë„ˆë¹„ 600px ì´í•˜) ---------- */
        @media (max-width: 600px) {
            
            body {
                padding: 5px;
            }
            
            .container {
                padding: 10px;
            }

            /* í…Œì´ë¸” - ë¶ˆí•„ìš”í•œ ì—´ ìˆ¨ê¸°ê¸° */
            #itemTableBody th:nth-child(3),
            #itemTableBody td:nth-child(3) {
                display: none; /* ë“±ë¡ ë‚ ì§œ ìˆ¨ê¸°ê¸° */
            }
            
            #itemTableBody th:nth-child(1),
            #itemTableBody td:nth-child(1) {
                width: 10%; /* ì‚¬ì§„ ì—´ ì¶•ì†Œ */
            }

            /* ìƒíƒœ ë° ê±°ë˜ ì•¡ì…˜ ì—´ ë„ˆë¹„ ì¡°ì • */
            #itemTableBody th:nth-child(4),
            #itemTableBody td:nth-child(4) {
                width: 25%;
                white-space: nowrap;
            }
            
            #itemTableBody th:nth-child(5),
            #itemTableBody td:nth-child(5) {
                width: 25%;
                white-space: nowrap;
            }
            
            .action-btn {
                padding: 4px 6px;
                font-size: 0.75em;
                display: block;
                margin: 2px 0;
            }

            /* ê´€ë¦¬ì ëª©ë¡ ìµœì í™” */
             #adminListPage th:nth-child(4),
             #adminListPage td:nth-child(4) {
                display: none; /* ê´€ë¦¬ì ëª©ë¡ì—ì„œ ë“±ë¡ì¼ ìˆ¨ê¸°ê¸° */
            }
            
             #adminListPage th:nth-child(6),
             #adminListPage td:nth-child(6) {
                display: none; /* ê´€ë¦¬ì ëª©ë¡ì—ì„œ êµ¬ë§¤ì ID ìˆ¨ê¸°ê¸° */
            }
            
            .admin-action-btn {
                padding: 4px 6px;
                font-size: 0.75em;
            }
        }
        /* ë‹¤ë¥¸ ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        .status-waiting { color: orange; font-weight: bold; } 
        .status-selling { color: green; } 
        .status-reserved { color: #800080; font-weight: bold; } 
        .status-completed { color: gray; } 

        .admin-action-btn, .action-btn {
            padding: 5px 10px;
            margin: 2px 5px 2px 0;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.85em;
        }
        
        .trade-apply-btn { background-color: #007BFF; color: white; } 
        .approve-btn { background-color: #28a745; color: white; } 
        .approve-trade-btn { background-color: #17a2b8; color: white; } 
        .confirm-trade-btn { background-color: #800080; color: white; } 
        .cancel-trade-btn { background-color: #dc3545; color: white; } 
        .edit-btn { background-color: #ffc107; color: #333; }
        .cancel-btn { background-color: #6c757d; color: white; }
        
        .admin-thumbnail {
            width: 40px; 
            height: 40px; 
            object-fit: cover;
            border-radius: 4px;
        }

    </style>
</head>
<body>
    <div class="container">
        <div id="userControlArea">
            <div>
                <button id="viewHistoryBtn" onclick="toggleBuyerHistoryPage(true)" style="display: none;">ë‚´ ì‹ ì²­ ë‚´ì—­ ë³´ê¸°</button>
                <button id="buyerLoginBtn" onclick="toggleBuyerLogin()">êµ¬ë§¤ì ë¡œê·¸ì¸</button>
            </div>
            <p id="buyerStatus" class="status-message buyer" style="display: none;">**êµ¬ë§¤ì: <span id="currentBuyerName"></span> í™œì„±í™”**</p>
        </div>

        <h1>ğŸ ì•„ì´í…œ ë¬´ë£Œ ë‚˜ëˆ” ê²Œì‹œíŒ</h1>

        <div id="mainContent">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="ì•„ì´í…œ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰...">
            </div>
            
            <div id="registerButtonContainer">
                <button onclick="toggleRegistrationForm(true)">ğŸ“¦ ì•„ì´í…œ ë“±ë¡í•˜ê¸°</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ì‚¬ì§„</th> 
                        <th>ì•„ì´í…œ ì´ë¦„</th>
                        <th>ë“±ë¡ ë‚ ì§œ</th>
                        <th>ìƒíƒœ</th>
                        <th>ê±°ë˜/ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="itemTableBody">
                    </tbody>
            </table>
        </div>
        
        <div id="adminListPage" style="display: none;" class="admin-list-container">
            <h2>ğŸš¨ ê´€ë¦¬ ëŒ€ê¸° ëª©ë¡ (ë“±ë¡ ìŠ¹ì¸ ë° ê±°ë˜ ê´€ë¦¬)</h2>
            <p>ì‹ ê·œ ë“±ë¡ ìŠ¹ì¸, ë‚˜ëˆ” ì‹ ì²­ ìŠ¹ì¸, ê±°ë˜ í™•ì • ê´€ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
            
            <button class="cancel-btn" onclick="toggleAdminListPage(false)" style="width: auto; margin-bottom: 20px;">ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>

            <table style="background-color: white;">
                <thead>
                    <tr>
                        <th>ì‚¬ì§„</th> 
                        <th>ID</th>
                        <th>ì•„ì´í…œ ì´ë¦„</th>
                        <th>ë“±ë¡ ë‚ ì§œ</th>
                        <th>í˜„ì¬ ìƒíƒœ</th>
                        <th>ì‹ ì²­/ì˜ˆì•½ êµ¬ë§¤ì ID</th>
                        <th>ì•¡ì…˜</th>
                    </tr>
                </thead>
                <tbody id="adminListBody">
                    </tbody>
            </table>
        </div>

        <div id="registrationFormPage" style="display: none;">
            <h3>ì•„ì´í…œ ë“±ë¡ ìš”ì²­</h3>
            <div class="form-content">
                <input type="text" id="itemName" placeholder="ì•„ì´í…œ ì´ë¦„">
                
                <label for="itemImageFile" style="font-size: 0.9em; display: block; margin-top: 0;">ì•„ì´í…œ ì‚¬ì§„ íŒŒì¼ ì„ íƒ:</label>
                <input type="file" id="itemImageFile" accept="image/*">
                
                <textarea id="itemDescription" placeholder="ìƒì„¸ ì„¤ëª… ë° ë‚˜ëˆ” ì¡°ê±´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."></textarea>
                
                <div class="form-actions">
                    <button onclick="addItemAsync()">ë“±ë¡ ìš”ì²­í•˜ê¸°</button>
                    <button class="cancel-btn" onclick="toggleRegistrationForm(false)">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>

        <div id="buyerHistoryPage" style="display: none;">
            <h2>ğŸ‘¤ <span id="historyBuyerName"></span> ë‹˜ì˜ ì‹ ì²­ ë‚´ì—­</h2>
            <p>ë‚˜ëˆ” ì‹ ì²­ ë° ì™„ë£Œ ì´ë ¥ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            
            <button class="cancel-btn" onclick="toggleBuyerHistoryPage(false)" style="width: auto; margin-bottom: 20px;">ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>

            <table>
                <thead>
                    <tr>
                        <th>ì•„ì´í…œ ì´ë¦„</th>
                        <th>ë“±ë¡ ë‚ ì§œ</th>
                        <th>ì‹ ì²­ ê²°ê³¼</th>
                        <th>ë¹„ê³ </th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                    </tbody>
            </table>
        </div>
    </div>
    
    <footer>
        <button id="adminListBtn" onclick="toggleAdminListPage(true)" style="display: none; background-color: #dc3545; color: white; margin-right: 15px;">ğŸš¨ ê´€ë¦¬ ëŒ€ê¸° ëª©ë¡ ë³´ê¸°</button>
        <button id="adminLoginBtn" onclick="toggleAdminLogin()">ê´€ë¦¬ì ë¡œê·¸ì¸</button>
    </footer>

    <script>
        let isAdmin = false;
        let isBuyerLoggedIn = false;
        let currentBuyerId = null;

        const buyers = {
            'buyer1': '1111',
            'buyer2': '2222'
        };

        const items = [
            // status: íŒë§¤ ì¤‘, ì˜ˆì•½ì¤‘, ê±°ë˜ ì™„ë£Œ, ìŠ¹ì¸ ëŒ€ê¸°
            // historyStatus: ì‹ ì²­ ê±°ì ˆ, êµ¬ë§¤ì ì·¨ì†Œ, ì˜ˆì•½ ìŠ¹ì¸, ê±°ë˜ í™•ì •, ì‹ ì²­ ì¤‘
            { id: 1, name: 'ê°•í™”ëœ ê²€', status: 'íŒë§¤ ì¤‘', description: 'ê³µê²©ë ¥ì´ 10 ì¦ê°€í•˜ëŠ” í¬ê·€í•œ ê²€ì…ë‹ˆë‹¤. ë‚´êµ¬ë„ 90%.', imageUrl: 'https://via.placeholder.com/150/007BFF/FFFFFF?text=Sword', buyerId: null, registerDate: '2025-11-10', historyStatus: 'ì‹ ì²­ ì—†ìŒ' },
            { id: 2, name: 'ë§ˆë²•ì‚¬ ëª¨ì', status: 'ê±°ë˜ ì™„ë£Œ', description: 'ì§€ëŠ¥ì„ ì˜¬ë ¤ì£¼ëŠ” ì¼ë°˜ì ì¸ ëª¨ìì…ë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/28A745/FFFFFF?text=Hat', buyerId: 'buyer2', registerDate: '2025-11-11', historyStatus: 'ê±°ë˜ í™•ì •', historyBuyerId: 'buyer2' }, 
            { id: 3, name: 'ë¹›ë‚˜ëŠ” ë°©íŒ¨', status: 'ì˜ˆì•½ì¤‘', description: 'í¬ë¯¸í•œ ë¹›ì„ ë‚´ëŠ” íŠ¼íŠ¼í•œ ë°©íŒ¨ì…ë‹ˆë‹¤. ë°©ì–´ë ¥ 5 ì¦ê°€.', imageUrl: 'https://via.placeholder.com/150/FFC107/333333?text=Shield', buyerId: 'buyer1', registerDate: '2025-11-12', historyStatus: 'ì˜ˆì•½ ìŠ¹ì¸', historyBuyerId: 'buyer1' },
            { id: 4, name: 'ê³ ëŒ€ ì§€ë„ ì¡°ê°', status: 'ìŠ¹ì¸ ëŒ€ê¸°', description: 'ë§¤ìš° í¬ê·€í•´ ë³´ì´ëŠ” ë³´ì„ì…ë‹ˆë‹¤.', imageUrl: 'https://via.placeholder.com/150/787878/FFFFFF?text=Map', buyerId: null, registerDate: '2025-11-13', historyStatus: 'ì‹ ì²­ ì—†ìŒ' },
            { id: 5, name: 'ì‹ ì†ì˜ í¬ì…˜', status: 'ì˜ˆì•½ì¤‘', description: 'ê±°ë˜ ì‹ ì²­ì´ ë“¤ì–´ì˜¨ í¬ì…˜ì…ë‹ˆë‹¤. 1íšŒìš©.', imageUrl: 'https://via.placeholder.com/150/DC3545/FFFFFF?text=Potion', buyerId: 'buyer1', registerDate: '2025-11-13', historyStatus: 'ì‹ ì²­ ì¤‘', historyBuyerId: 'buyer1' },
            
            // 15ê°œ ì•„ì´í…œ ì¶”ê°€ (ì´ 20ê°œ)
            { id: 6, name: 'ë‚¡ì€ ê°€ì£½ ê°‘ì˜·', status: 'íŒë§¤ ì¤‘', description: 'ê¸°ë³¸ ë°©ì–´ë ¥ì´ ìˆëŠ” ë‚¡ì€ ê°‘ì˜·.', imageUrl: 'https://via.placeholder.com/150/8B4513/FFFFFF?text=Armor', buyerId: null, registerDate: '2025-11-14', historyStatus: 'ì‹ ì²­ ì—†ìŒ' },
            { id: 7, name: 'íˆ¬ëª… ë§í† ', status: 'ìŠ¹ì¸ ëŒ€ê¸°', description: 'ìˆ¨ê²¨ì§„ ì•„ì´í…œ. ê´€ë¦¬ì ìŠ¹ì¸ ëŒ€ê¸° ì¤‘.', imageUrl: 'https://via.placeholder.com/150/4B0082/FFFFFF?text=Cloak', buyerId: null, registerDate: '2025-11-15', historyStatus: 'ì‹ ì²­ ì—†ìŒ' },
            { id: 8, name: 'ìƒëª…ì˜ ë°˜ì§€', status: 'íŒë§¤ ì¤‘', description: 'ì²´ë ¥ ì¬ìƒ ì†ë„ë¥¼ ë†’ì—¬ì£¼ëŠ” ë°˜ì§€.', imageUrl: 'https://via.placeholder.com/150/FF69B4/FFFFFF?text=Ring', buyerId: null, registerDate: '2025-11-16', historyStatus: 'ì‹ ì²­ ì—†ìŒ' },
            { id: 9, name: 'ë¶ˆì˜ ì •ìˆ˜', status: 'ì˜ˆì•½ì¤‘', description: 'ë¶ˆ ë§ˆë²• ì¬ë£Œ.', imageUrl: 'https://via.placeholder.com/150/FF4500/FFFFFF?text=Essence', buyerId: 'buyer2', registerDate: '2025-11-17', historyStatus: 'ì‹ ì²­ ì¤‘', historyBuyerId: 'buyer2' },
            { id: 10, name: 'ë§ˆë‚˜ ë¬¼ì•½(ëŒ€)', status: 'ì˜ˆì•½ì¤‘', description: 'ëŒ€ëŸ‰ì˜ ë§ˆë‚˜ë¥¼ íšŒë³µì‹œì¼œì£¼ëŠ” ë¬¼ì•½.', imageUrl: 'https://via.placeholder.com/150/00FFFF/000000?text=MP+Pot', buyerId: 'buyer2', registerDate: '2025-11-18', historyStatus: 'ì˜ˆì•½ ìŠ¹ì¸', historyBuyerId: 'buyer2' },
            { id: 11, name: 'ë¯¸ë‹ˆ ê³¨ë ˜ ì¡°ê°', status: 'ê±°ë˜ ì™„ë£Œ', description: 'ì‘ì€ ê³¨ë ˜ì„ ì†Œí™˜í•˜ëŠ” ë° ì‚¬ìš©ëœ ì¡°ê°.', imageUrl: 'https://via.placeholder.com/150/A9A9A9/000000?text=Golem', buyerId: 'buyer1', registerDate: '2025-11-19', historyStatus: 'ê±°ë˜ í™•ì •', historyBuyerId: 'buyer1' },
            { id: 12, name: 'ë²ˆê°œ ì§€íŒ¡ì´', status: 'íŒë§¤ ì¤‘', description: 'ë²ˆê°œ ë§ˆë²• ì¦í­.', imageUrl: 'https://via.placeholder.com/150/800080/FFFFFF?text=Wand', buyerId: null, registerDate: '2025-11-20', historyStatus: 'ì‹ ì²­ ì—†ìŒ' },
            { id: 13, name: 'ìš©ì˜ ë¹„ëŠ˜', status: 'íŒë§¤ ì¤‘', description: 'í¬ê·€ ë°©ì–´êµ¬ ì œì‘ ì¬ë£Œ.', imageUrl: 'https://via.placeholder.com/150/4682B4/FFFFFF?text=Scale', buyerId: null, registerDate: '2025-11-21', historyStatus: 'ì‹ ì²­ ì—†ìŒ' },
            { id: 14, name: 'ì‚¬ëƒ¥ê¾¼ì˜ í™œ', status: 'ì˜ˆì•½ì¤‘', description: 'ì •í™•ë„ê°€ ë†’ì€ í™œ.', imageUrl: 'https://via.placeholder.com/150/228B22/FFFFFF?text=Bow', buyerId: 'buyer1', registerDate: '2025-11-22', historyStatus: 'ì‹ ì²­ ì¤‘', historyBuyerId: 'buyer1' },
            { id: 15, name: 'ë… ì¶”ì¶œì•¡', status: 'íŒë§¤ ì¤‘', description: 'ë¬´ê¸°ì— ë…ì„ ë°”ë¥´ëŠ” ë° ì‚¬ìš©.', imageUrl: 'https://via.placeholder.com/150/556B2F/FFFFFF?text=Poison', buyerId: null, registerDate: '2025-11-23', historyStatus: 'ì‹ ì²­ ì—†ìŒ' },
            { id: 16, name: 'ë¯¸ìŠ¤í„°ë¦¬ ìƒì', status: 'íŒë§¤ ì¤‘', description: 'ë¬´ì—‡ì´ ë“¤ì–´ìˆì„ì§€ ì•„ë¬´ë„ ëª¨ë¥´ëŠ” ìƒì.', imageUrl: 'https://via.placeholder.com/150/9932CC/FFFFFF?text=Box', buyerId: null, registerDate: '2025-11-24', historyStatus: 'ì‹ ì²­ ì—†ìŒ' },
            { id: 17, name: 'ì˜ì›ì˜ ì´›ë¶ˆ', status: 'ìŠ¹ì¸ ëŒ€ê¸°', description: 'ì ˆëŒ€ êº¼ì§€ì§€ ì•ŠëŠ” ì‹ ë¹„í•œ ì´›ë¶ˆ.', imageUrl: 'https://via.placeholder.com/150/FFD700/000000?text=Candle', buyerId: null, registerDate: '2025-11-25', historyStatus: 'ì‹ ì²­ ì—†ìŒ' },
            { id: 18, name: 'ì‹œê°„ì˜ ëª¨ë˜', status: 'íŒë§¤ ì¤‘', description: 'ì‹œê°„ì„ ë˜ëŒë¦¬ëŠ” ë° í•„ìš”í•œ ë§ˆë²• ì¬ë£Œ.', imageUrl: 'https://via.placeholder.com/150/B0C4DE/000000?text=Sand', buyerId: null, registerDate: '2025-11-26', historyStatus: 'ì‹ ì²­ ì—†ìŒ' },
            { id: 19, name: 'ìŒìœ ì‹œì¸ì˜ ë¦¬ë¼', status: 'ê±°ë˜ ì™„ë£Œ', description: 'ì•„ë¦„ë‹¤ìš´ ìŒì•…ì„ ì—°ì£¼í•˜ëŠ” ì•…ê¸°.', imageUrl: 'https://via.placeholder.com/150/CD853F/FFFFFF?text=Lyre', buyerId: 'buyer2', registerDate: '2025-11-27', historyStatus: 'ê±°ë˜ í™•ì •', historyBuyerId: 'buyer2' },
            { id: 20, name: 'ë‹¬ë¹› ìˆ˜ì •êµ¬', status: 'ì˜ˆì•½ì¤‘', description: 'ë°¤ì—ë„ ì£¼ë³€ì„ ë°ê²Œ ë¹„ì¶°ì£¼ëŠ” ìˆ˜ì •êµ¬.', imageUrl: 'https://via.placeholder.com/150/DDA0DD/000000?text=Crystal', buyerId: 'buyer1', registerDate: '2025-11-28', historyStatus: 'ì˜ˆì•½ ìŠ¹ì¸', historyBuyerId: 'buyer1' }
        ];
        
        function getTodayDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getStatusClass(status) {
            if (status === 'ìŠ¹ì¸ ëŒ€ê¸°') return 'status-waiting';
            if (status === 'íŒë§¤ ì¤‘') return 'status-selling'; 
            if (status === 'ì˜ˆì•½ì¤‘') return 'status-reserved'; 
            if (status === 'ê±°ë˜ ì™„ë£Œ') return 'status-completed'; 
            return '';
        }
        
        function getDisplayStatusText(internalStatus, isBuyerMatch, historyStatus) {
            if (internalStatus === 'ìŠ¹ì¸ ëŒ€ê¸°') return 'ìŠ¹ì¸ ëŒ€ê¸°';
            if (internalStatus === 'íŒë§¤ ì¤‘') return 'ì‹ ì²­ ê°€ëŠ¥'; 
            if (internalStatus === 'ê±°ë˜ ì™„ë£Œ') {
                return isBuyerMatch ? 'ë‚˜ëˆ” ì™„ë£Œ! (íšë“)' : 'ë‚˜ëˆ” ì™„ë£Œ'; 
            }
            
            if (internalStatus === 'ì˜ˆì•½ì¤‘') {
                if (historyStatus === 'ì˜ˆì•½ ìŠ¹ì¸' && isBuyerMatch) {
                     return 'ì˜ˆì•½ ì¤‘(ë‚˜)'; 
                } else if (historyStatus === 'ì‹ ì²­ ì¤‘' && isBuyerMatch) {
                    return 'ì˜ˆì•½ ì¤‘(ì‹ ì²­)'; 
                } else if (historyStatus === 'ì˜ˆì•½ ìŠ¹ì¸' && !isBuyerMatch) {
                    return 'ì˜ˆì•½ ì¤‘'; 
                } else {
                    return 'ì˜ˆì•½ ì¤‘'; 
                }
            }
            
            return internalStatus;
        }

        // --- í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜ ---

        function toggleBuyerHistoryPage(show) {
            const mainContent = document.getElementById('mainContent');
            const historyPage = document.getElementById('buyerHistoryPage');
            const registrationFormPage = document.getElementById('registrationFormPage');
            const adminPage = document.getElementById('adminListPage');

            if (show) {
                if (!isBuyerLoggedIn) {
                    alert('êµ¬ë§¤ìë¡œ ë¡œê·¸ì¸í•´ì•¼ ì‹ ì²­ ë‚´ì—­ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }
                mainContent.style.display = 'none';
                registrationFormPage.style.display = 'none';
                adminPage.style.display = 'none';
                historyPage.style.display = 'block';
                document.getElementById('historyBuyerName').textContent = currentBuyerId;
                renderBuyerHistory();
            } else {
                mainContent.style.display = 'block';
                historyPage.style.display = 'none';
                renderItems();
            }
        }
        
        function toggleRegistrationForm(show) {
            const mainContent = document.getElementById('mainContent');
            const formPage = document.getElementById('registrationFormPage');
            const historyPage = document.getElementById('buyerHistoryPage');
            const adminPage = document.getElementById('adminListPage');

            if (show) {
                mainContent.style.display = 'none';
                historyPage.style.display = 'none';
                adminPage.style.display = 'none';
                formPage.style.display = 'block';
                document.getElementById('itemName').value = '';
                document.getElementById('itemImageFile').value = '';
                document.getElementById('itemDescription').value = '';
            } else {
                mainContent.style.display = 'block';
                formPage.style.display = 'none';
                renderItems(); 
            }
        }
        
        function toggleAdminListPage(show) {
            const mainContent = document.getElementById('mainContent');
            const historyPage = document.getElementById('buyerHistoryPage');
            const formPage = document.getElementById('registrationFormPage');
            const adminPage = document.getElementById('adminListPage');

            if (show) {
                if (!isAdmin) {
                    alert('ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸í•´ì•¼ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }
                mainContent.style.display = 'none';
                historyPage.style.display = 'none';
                formPage.style.display = 'none';
                adminPage.style.display = 'block';
                renderAdminList(); 
            } else {
                mainContent.style.display = 'block';
                adminPage.style.display = 'none';
                renderItems(); 
            }
        }
        
        // --- ë Œë”ë§ í•¨ìˆ˜ ---

        function renderItems(filteredItems = items) {
            const tableBody = document.getElementById('itemTableBody');
            tableBody.innerHTML = ''; 

            // 1. ìŠ¹ì¸ ëŒ€ê¸° ì•„ì´í…œ ì œì™¸
            let approvedItems = filteredItems.filter(item => item.status !== 'ìŠ¹ì¸ ëŒ€ê¸°');
            
            // 2. ì•„ì´í…œ ìƒíƒœë³„ ì •ë ¬ ìˆœì„œ ì •ì˜ (ê±°ë˜ ì™„ë£Œë¥¼ ë§¨ ì•„ë˜ë¡œ)
            const statusOrder = {
                'íŒë§¤ ì¤‘': 1,
                'ì˜ˆì•½ì¤‘': 2,
                'ê±°ë˜ ì™„ë£Œ': 3
            };
            
            // 3. ì •ë ¬ ë¡œì§ ì ìš©
            approvedItems.sort((a, b) => {
                const orderA = statusOrder[a.status] || 99;
                const orderB = statusOrder[b.status] || 99;
                return orderA - orderB;
            });
            // ì •ë ¬ ë¡œì§ ì ìš© ì™„ë£Œ

            approvedItems.forEach(item => {
                const row = document.createElement('tr');
                row.classList.add('item-row');
                
                const displayImageUrl = item.imageUrl && item.imageUrl.trim() !== '' ? item.imageUrl : 'https://via.placeholder.com/50/808080/FFFFFF?text=No+Img';
                
                const isBuyerMatch = isBuyerLoggedIn && item.buyerId === currentBuyerId;

                let statusText = getDisplayStatusText(item.status, isBuyerMatch, item.historyStatus); 
                let statusClass = getStatusClass(item.status);
                
                let actionButton = '';
                if (isAdmin) {
                    actionButton = `
                        <button class="admin-action-btn edit-btn" onclick="editItem(${item.id})">ìˆ˜ì •</button>
                        <button class="admin-action-btn delete-btn item-delete-btn" data-item-id="${item.id}">ì‚­ì œ</button>
                    `;
                } else if (isBuyerLoggedIn && item.status === 'íŒë§¤ ì¤‘') { 
                    actionButton = `<button class="action-btn trade-apply-btn" onclick="applyForTrade(${item.id})">ì‹ ì²­</button>`;
                } else if (isBuyerLoggedIn && item.status === 'ì˜ˆì•½ì¤‘' && isBuyerMatch) {
                    actionButton = `<button class="action-btn cancel-trade-btn" onclick="cancelTradeByBuyer(${item.id})">ì˜ˆì•½ ì·¨ì†Œ</button>`;
                } else if (!isBuyerLoggedIn && item.status === 'íŒë§¤ ì¤‘') {
                    actionButton = `<span style="color:#17a2b8;">ë¡œê·¸ì¸ í›„ ì‹ ì²­</span>`;
                } else if (item.status === 'ì˜ˆì•½ì¤‘' && item.buyerId !== currentBuyerId) {
                    actionButton = `<span class="${getStatusClass(item.status)}">${statusText}</span>`; 
                }

                row.innerHTML = `
                    <td>
                        <img src="${displayImageUrl}" alt="${item.name} ì´ë¯¸ì§€" class="item-thumbnail">
                    </td>
                    <td>${item.name}</td>
                    <td>${item.registerDate || '-'}</td>
                    <td class="${statusClass}">${statusText}</td>
                    <td>${actionButton}</td>
                `;
                
                row.onclick = () => toggleDetails(item.id);
                tableBody.appendChild(row);
                
                if (isAdmin) {
                    const deleteButton = row.querySelector(`.item-delete-btn[data-item-id="${item.id}"]`);
                    if (deleteButton) {
                        deleteButton.addEventListener('click', (event) => {
                            event.stopPropagation();
                            deleteItem(item.id);
                        });
                    }
                }

                const detailRow = document.createElement('tr');
                detailRow.classList.add('detail-row');
                detailRow.id = `detail-${item.id}`;
                
                const formattedDescription = (item.description || 'ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.').replace(/\n/g, '<br>');
                const detailImageUrl = item.imageUrl && item.imageUrl.trim() !== '' ? item.imageUrl : 'https://via.placeholder.com/250/808080/FFFFFF?text=No+Image';

                detailRow.innerHTML = `
                    <td colspan="5"> 
                        <div class="detail-content">
                            <img src="${detailImageUrl}" alt="${item.name} ìƒì„¸ ì´ë¯¸ì§€" class="detail-image">
                            <div class="detail-text">
                                <strong>ìƒì„¸ ì„¤ëª…:</strong><br>
                                ${formattedDescription}
                            </div>
                        </div>
                    </td>
                `;
                tableBody.appendChild(detailRow);
            });
            
            // í‘¸í„°ì˜ ê´€ë¦¬ ëŒ€ê¸° ë²„íŠ¼ ì œì–´
            const adminListBtn = document.getElementById('adminListBtn');
            const adminPageVisible = document.getElementById('adminListPage').style.display !== 'none';

            if (isAdmin && !adminPageVisible) {
                const adminCount = items.filter(item => item.status === 'ìŠ¹ì¸ ëŒ€ê¸°' || item.status === 'ì˜ˆì•½ì¤‘').length;
                adminListBtn.style.display = 'inline-block';
                adminListBtn.textContent = `ğŸš¨ ê´€ë¦¬ ëŒ€ê¸° ëª©ë¡ ë³´ê¸° (${adminCount}ê±´)`;
            } else {
                adminListBtn.style.display = 'none';
            }
        }

        function renderBuyerHistory() {
            const historyBody = document.getElementById('historyTableBody');
            historyBody.innerHTML = '';

            const historyItems = items.filter(item => 
                item.historyBuyerId === currentBuyerId
            );

            historyItems.forEach(item => {
                let displayStatus = '';
                let statusColor = '';

                if (item.historyStatus === 'ê±°ë˜ í™•ì •' && item.status === 'ê±°ë˜ ì™„ë£Œ') {
                    displayStatus = 'ê±°ë˜ í™•ì • (ë‚˜ëˆ” ì™„ë£Œ)';
                    statusColor = 'green';
                } else if (item.historyStatus === 'ì˜ˆì•½ ìŠ¹ì¸' && item.status === 'ì˜ˆì•½ì¤‘') {
                    displayStatus = 'ì˜ˆì•½ ìŠ¹ì¸ (ê±°ë˜ ì¤€ë¹„ ì¤‘)';
                    statusColor = '#800080';
                } else if (item.historyStatus === 'ì‹ ì²­ ì¤‘' && item.status === 'ì˜ˆì•½ì¤‘') {
                    displayStatus = 'ì‹ ì²­ ì¤‘ (ì˜ˆì•½ ëŒ€ê¸°)';
                    statusColor = '#007BFF';
                } else if (item.historyStatus === 'ì‹ ì²­ ê±°ì ˆ') {
                    displayStatus = 'ì‹ ì²­ ê±°ì ˆ (ê´€ë¦¬ì ì·¨ì†Œ)';
                    statusColor = 'red';
                } else if (item.historyStatus === 'êµ¬ë§¤ì ì·¨ì†Œ') {
                    displayStatus = 'ì‹ ì²­/ì˜ˆì•½ ì·¨ì†Œ (êµ¬ë§¤ì ì·¨ì†Œ)';
                    statusColor = 'orange';
                } else {
                    return; 
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.registerDate || '-'}</td>
                    <td style="color: ${statusColor}; font-weight: bold;">${displayStatus}</td>
                    <td>${item.description.substring(0, 30)}...</td>
                `;
                historyBody.appendChild(row);
            });
            
            if (historyItems.length === 0) {
                 historyBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">ì•„ì§ ë‚˜ëˆ” ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }
        }

        function renderAdminList() {
            if (!isAdmin) return;

            const adminListBody = document.getElementById('adminListBody');
            adminListBody.innerHTML = '';
            
            // ê´€ë¦¬ ëŒ€ìƒ ì•„ì´í…œ: ìŠ¹ì¸ ëŒ€ê¸°, ì˜ˆì•½ì¤‘
            const adminItems = items.filter(item => item.status === 'ìŠ¹ì¸ ëŒ€ê¸°' || item.status === 'ì˜ˆì•½ì¤‘');

            if (adminItems.length > 0) {
                adminItems.forEach(item => {
                    let actions = '';
                    let displayStatus = '';

                    if (item.status === 'ìŠ¹ì¸ ëŒ€ê¸°') {
                        displayStatus = 'ë“±ë¡ ìŠ¹ì¸ ëŒ€ê¸°';
                        actions = `
                            <button class="admin-action-btn approve-btn" onclick="approveItem(${item.id})">ë“±ë¡ ìŠ¹ì¸</button>
                            <button class="admin-action-btn delete-btn" onclick="deleteItem(${item.id})">ì‚­ì œ</button>
                        `;
                    } else if (item.status === 'ì˜ˆì•½ì¤‘') {
                        if (item.historyStatus === 'ì‹ ì²­ ì¤‘') {
                            // ì˜ˆì•½ ëŒ€ê¸° ìƒíƒœ -> 1ë‹¨ê³„ ìŠ¹ì¸ í•„ìš”
                            displayStatus = 'ë‚˜ëˆ” ì‹ ì²­ (1ë‹¨ê³„)'; 
                            actions = `
                                <button class="admin-action-btn approve-trade-btn" onclick="approveTrade(${item.id})">ë‚˜ëˆ” ì‹ ì²­ ìŠ¹ì¸</button> 
                                <button class="admin-action-btn cancel-trade-btn" onclick="cancelTradeByAdmin(${item.id})">ì‹ ì²­ ì·¨ì†Œ</button>
                            `;
                        } else if (item.historyStatus === 'ì˜ˆì•½ ìŠ¹ì¸') {
                            // ì˜ˆì•½ í™•ì • ìƒíƒœ -> ìµœì¢… í™•ì • í•„ìš”
                            displayStatus = 'ë‚˜ëˆ” ì§„í–‰ (2ë‹¨ê³„)'; 
                            actions = `
                                <button class="admin-action-btn confirm-trade-btn" onclick="confirmTrade(${item.id})">ë‚˜ëˆ” ì™„ë£Œ</button> 
                                <button class="admin-action-btn cancel-trade-btn" onclick="cancelTradeByAdmin(${item.id})">ì˜ˆì•½ ì·¨ì†Œ</button>
                            `;
                        } else {
                            displayStatus = 'ì˜ˆì•½ì¤‘ (ìƒíƒœ í™•ì¸ í•„ìš”)';
                            actions = `
                                <button class="admin-action-btn cancel-trade-btn" onclick="cancelTradeByAdmin(${item.id})">ì˜ˆì•½ ì·¨ì†Œ</button>
                            `;
                        }
                    }
                    
                    const displayImageUrl = item.imageUrl && item.imageUrl.trim() !== '' ? item.imageUrl : 'https://via.placeholder.com/40/808080/FFFFFF?text=No';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <img src="${displayImageUrl}" alt="${item.name} ì´ë¯¸ì§€" class="admin-thumbnail">
                        </td>
                        <td>${item.id}</td>
                        <td>${item.name}</td>
                        <td>${item.registerDate || '-'}</td>
                        <td class="${getStatusClass(item.status)}">${displayStatus}</td>
                        <td>${item.buyerId || '-'}</td>
                        <td>${actions}</td>
                    `;
                    adminListBody.appendChild(row);
                });
            } else {
                adminListBody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #555;">í˜„ì¬ ê´€ë¦¬ ëŒ€ê¸° ì¤‘ì¸ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }
        }
        
        // --- ì•¡ì…˜ í›„ ëª©ë¡ ê°±ì‹  í—¬í¼ ---

        function updateListsAfterAction() {
            if (document.getElementById('adminListPage').style.display !== 'none') {
                 renderAdminList(); 
                 renderItems(); // í‘¸í„° ë²„íŠ¼ ì¹´ìš´íŠ¸ ê°±ì‹ ì„ ìœ„í•´ ë©”ì¸ ëª©ë¡ë„ ê°±ì‹ 
            } else if (document.getElementById('mainContent').style.display !== 'none') {
                renderItems(); 
            }
            if (isBuyerLoggedIn && document.getElementById('buyerHistoryPage').style.display !== 'none') {
                renderBuyerHistory();
            }
        }
        
        function toggleDetails(itemId) {
            const detailRow = document.getElementById(`detail-${itemId}`);
            if (detailRow.style.display === 'table-row') {
                detailRow.style.display = 'none';
            } else {
                document.querySelectorAll('.detail-row').forEach(row => {
                    if (row.id !== `detail-${itemId}`) {
                        row.style.display = 'none';
                    }
                });
                detailRow.style.display = 'table-row';
            }
        }

        // --- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ ---
        
        function toggleBuyerLogin() {
            if (isBuyerLoggedIn) {
                logoutBuyer();
            } else {
                loginBuyer();
            }
        }

        function loginBuyer() {
            const buyerIdInput = prompt("êµ¬ë§¤ì IDë¥¼ ì…ë ¥í•˜ì„¸ìš”. (í…ŒìŠ¤íŠ¸ ID: buyer1, buyer2)");
            if (!buyerIdInput) return;

            const passwordInput = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (buyer1: 1111, buyer2: 2222)");
            if (!passwordInput) return;

            if (buyers[buyerIdInput] === passwordInput) {
                isBuyerLoggedIn = true;
                currentBuyerId = buyerIdInput;
                document.getElementById('buyerLoginBtn').innerText = 'êµ¬ë§¤ì ë¡œê·¸ì•„ì›ƒ';
                document.getElementById('currentBuyerName').innerText = currentBuyerId;
                document.getElementById('buyerStatus').style.display = 'block';
                document.getElementById('viewHistoryBtn').style.display = 'inline-block';
                renderItems(); 
            } else {
                alert('ID ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
            }
        }

        function logoutBuyer() {
            isBuyerLoggedIn = false;
            currentBuyerId = null;
            document.getElementById('buyerLoginBtn').innerText = 'êµ¬ë§¤ì ë¡œê·¸ì¸';
            document.getElementById('buyerStatus').style.display = 'none';
            document.getElementById('viewHistoryBtn').style.display = 'none';
            
            if (document.getElementById('buyerHistoryPage').style.display !== 'none') {
                toggleBuyerHistoryPage(false);
            }
            renderItems();
        }
        
        function toggleAdminLogin() {
            if (isAdmin) {
                logoutAdmin();
            } else {
                loginAdmin();
            }
        }

        function loginAdmin() {
            const password = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ë¹„ë°€ë²ˆí˜¸: 1234)");
            if (password === '1234') {
                isAdmin = true;
                document.getElementById('adminLoginBtn').innerText = 'ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ';
                renderItems(); 
            } else if (password !== null) {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
            }
        }

        function logoutAdmin() {
            isAdmin = false;
            document.getElementById('adminLoginBtn').innerText = 'ê´€ë¦¬ì ë¡œê·¸ì¸';
            document.getElementById('adminListBtn').style.display = 'none'; 
            if (document.getElementById('adminListPage').style.display !== 'none') {
                toggleAdminListPage(false); 
            } else {
                 renderItems(); 
            }
        }
        
        // --- ê±°ë˜/ê´€ë¦¬ ì•¡ì…˜ í•¨ìˆ˜ ---

        function applyForTrade(itemId) {
            if (!isBuyerLoggedIn || isAdmin) {
                alert('êµ¬ë§¤ìë¡œ ë¡œê·¸ì¸í•´ì•¼ ì‹ ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const item = items.find(i => i.id === itemId);
            if (item && item.status === 'íŒë§¤ ì¤‘') { 
                item.status = 'ì˜ˆì•½ì¤‘'; // ìƒíƒœ ê°„ì†Œí™” ì ìš©
                item.buyerId = currentBuyerId;
                item.historyStatus = 'ì‹ ì²­ ì¤‘';
                item.historyBuyerId = currentBuyerId;
                alert(`${item.name}ì— ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì˜ 1ë‹¨ê³„ ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.`);
                updateListsAfterAction(); 
            }
        }
        
        // 1ë‹¨ê³„ ìŠ¹ì¸: ì˜ˆì•½ì¤‘(ì‹ ì²­ ì¤‘) -> ì˜ˆì•½ì¤‘(ì˜ˆì•½ ìŠ¹ì¸)
        function approveTrade(itemId) {
            if (!isAdmin) return;
            
            const item = items.find(i => i.id === itemId);
            if (item && item.status === 'ì˜ˆì•½ì¤‘' && item.historyStatus === 'ì‹ ì²­ ì¤‘') { 
                // ìƒíƒœëŠ” 'ì˜ˆì•½ì¤‘'ìœ¼ë¡œ ìœ ì§€í•˜ë˜, historyStatusë¥¼ ë³€ê²½í•˜ì—¬ 1ë‹¨ê³„ ìŠ¹ì¸ ì™„ë£Œë¥¼ í‘œì‹œ
                item.historyStatus = 'ì˜ˆì•½ ìŠ¹ì¸'; 
                alert(`${item.name}ì˜ ë‚˜ëˆ” ì‹ ì²­ì´ 1ë‹¨ê³„ ìŠ¹ì¸ë˜ì–´ 'ê±°ë˜ ì˜ˆì•½ í™•ì •' ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. (ì‹¤ë¬¼ ê±°ë˜ í›„ 'ë‚˜ëˆ” ì™„ë£Œ' í•„ìš”)`);
                updateListsAfterAction(); 
            }
        }
        
        // 2ë‹¨ê³„ ìŠ¹ì¸: ì˜ˆì•½ì¤‘(ì˜ˆì•½ ìŠ¹ì¸) -> ê±°ë˜ ì™„ë£Œ (ìµœì¢… í™•ì •)
        function confirmTrade(itemId) {
             if (!isAdmin) return;
            
            const item = items.find(i => i.id === itemId);
            if (item && item.status === 'ì˜ˆì•½ì¤‘' && item.historyStatus === 'ì˜ˆì•½ ìŠ¹ì¸') { 
                item.status = 'ê±°ë˜ ì™„ë£Œ'; 
                item.historyStatus = 'ê±°ë˜ í™•ì •';
                alert(`${item.name}ì˜ ê±°ë˜ê°€ ìµœì¢… í™•ì •ë˜ì–´ 'ë‚˜ëˆ” ì™„ë£Œ' ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`); 
                updateListsAfterAction(); 
            }
        }
        
        function approveItem(itemId) {
            if (!isAdmin) return;
            
            const item = items.find(i => i.id === itemId);
            if (item && item.status === 'ìŠ¹ì¸ ëŒ€ê¸°') {
                item.status = 'íŒë§¤ ì¤‘'; 
                alert(`${item.name} ì•„ì´í…œì´ ëª©ë¡ì— ë“±ë¡(ìŠ¹ì¸)ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                updateListsAfterAction(); 
            }
        }
        
        function deleteItem(itemId) {
            if (!isAdmin) return;

            if (confirm("ì •ë§ë¡œ ì´ ì•„ì´í…œì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                const index = items.findIndex(i => i.id === itemId);
                if (index > -1) {
                    items.splice(index, 1);
                    updateListsAfterAction(); 
                }
            }
        }
        
        function cancelTradeByAdmin(itemId) {
            if (!isAdmin) return;

            const item = items.find(i => i.id === itemId);
            
            if (item && item.status === 'ì˜ˆì•½ì¤‘') {
                if (confirm(`${item.name}ì— ëŒ€í•œ ë‚˜ëˆ” ì‹ ì²­/ì˜ˆì•½ì„ ì·¨ì†Œí•˜ê³  'ì‹ ì²­ ê°€ëŠ¥' ìƒíƒœë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    item.historyStatus = 'ì‹ ì²­ ê±°ì ˆ';
                    item.historyBuyerId = item.buyerId; 
                    
                    item.status = 'íŒë§¤ ì¤‘'; 
                    item.buyerId = null; 
                    alert(`${item.name}ì˜ ë‚˜ëˆ” ì‹ ì²­/ì˜ˆì•½ì´ ì·¨ì†Œë˜ê³  'ì‹ ì²­ ê°€ëŠ¥' ìƒíƒœë¡œ ë³µê·€í–ˆìŠµë‹ˆë‹¤.`);
                    updateListsAfterAction(); 
                }
            }
        }
        
        function cancelTradeByBuyer(itemId) {
            if (!isBuyerLoggedIn) return;

            const item = items.find(i => i.id === itemId);
            
            if (item && item.status === 'ì˜ˆì•½ì¤‘' && item.buyerId === currentBuyerId) {
                if (confirm(`${item.name}ì— ëŒ€í•œ ì‹ ì²­/ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ìƒíƒœ: ì˜ˆì•½ì¤‘)`)) {
                    item.status = 'íŒë§¤ ì¤‘'; 
                    item.historyStatus = 'êµ¬ë§¤ì ì·¨ì†Œ';
                    item.historyBuyerId = item.buyerId; 
                    item.buyerId = null; 
                    alert(`${item.name}ì˜ ì‹ ì²­/ì˜ˆì•½ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    
                    updateListsAfterAction();
                }
            }
        }
        
        function editItem(itemId) {
            if (!isAdmin) return;

            const item = items.find(i => i.id === itemId);
            if (!item) return;

            const newName = prompt(`[${item.name}]ì˜ ìƒˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:`, item.name);
            if (newName === null) return; 

            const newDescription = prompt(`[${item.name}]ì˜ ìƒˆ ìƒì„¸ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”:`, item.description);
            if (newDescription === null) return;
            
            const newImageUrl = prompt(`[${item.name}]ì˜ ìƒˆ ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš” (ë³€ê²½í•˜ì§€ ì•Šìœ¼ë ¤ë©´ ê³µë°±):`, item.imageUrl);
            
            item.name = newName.trim();
            item.description = newDescription.trim();
            
            if (newImageUrl.trim() !== "") {
                item.imageUrl = newImageUrl.trim();
            }

            alert(`ì•„ì´í…œ [${item.id}]ì˜ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            renderItems();
        }
        
        // --- ì•„ì´í…œ ë“±ë¡ í•¨ìˆ˜ ---

        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        async function addItemAsync() {
            const itemNameInput = document.getElementById('itemName');
            const itemImageFileInput = document.getElementById('itemImageFile');
            const itemDescriptionInput = document.getElementById('itemDescription');
            
            const name = itemNameInput.value.trim();
            const description = itemDescriptionInput.value.trim(); 
            const file = itemImageFileInput.files[0];

            if (!name || !description) {
                alert('ì•„ì´í…œ ì´ë¦„ê³¼ ìƒì„¸ ì„¤ëª…ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            let imageUrl = '';

            if (file) {
                try {
                    imageUrl = await convertFileToBase64(file);
                } catch (error) {
                    console.error('íŒŒì¼ ë³€í™˜ ì˜¤ë¥˜:', error);
                    alert('ì´ë¯¸ì§€ íŒŒì¼ ë³€í™˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    return;
                }
            } else {
                 imageUrl = 'https://via.placeholder.com/150/808080/FFFFFF?text=No+Image';
            }

            const newId = items.length > 0 ? Math.max(...items.map(i => i.id)) + 1 : 1;

            items.push({ 
                id: newId, 
                name: name, 
                status: 'ìŠ¹ì¸ ëŒ€ê¸°', 
                description: description,
                imageUrl: imageUrl,
                buyerId: null,
                registerDate: getTodayDate(),
                historyStatus: 'ì‹ ì²­ ì—†ìŒ'
            });
            
            alert(`ì•„ì´í…œ [${name}]ì´(ê°€) ë“±ë¡ ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.`);

            toggleRegistrationForm(false);
        }

        // --- ê²€ìƒ‰ ê¸°ëŠ¥ ---

        function searchItems() {
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput.value.trim().toLowerCase();

            const filteredItems = items.filter(item => 
                item.name.toLowerCase().includes(searchTerm) || 
                item.description.toLowerCase().includes(searchTerm)
            );

            renderItems(filteredItems);
        }

        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', searchItems);

        // --- ì´ˆê¸° ì‹¤í–‰ ---
        renderItems();
    </script>
</body>
</html>